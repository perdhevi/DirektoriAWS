(this["webpackJsonpfront-admin"]=this["webpackJsonpfront-admin"]||[]).push([[0],{189:function(e,t,a){e.exports=a(333)},333:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(31),c=a.n(o),s=a(28),i=a(47),l=a(161),u=a(26),m=a(27),d=a(34),h=a(33),p=a(29),g=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.auth,t=e.login,a=e.logout,n=e.isAuthenticated;return r.a.createElement("div",{className:"ui menu top "},r.a.createElement("div",{className:"item"},r.a.createElement(p.b,{to:"/"},"Home")),n()?r.a.createElement("div",{className:"item"},r.a.createElement(p.b,{to:"/stores"},"Store")):r.a.createElement("div",null),n()?r.a.createElement("div",{className:"item"},r.a.createElement(p.b,{to:"/categories"},"Category")):r.a.createElement("div",null),r.a.createElement("div",{className:"item right"},n()?r.a.createElement("button",{onClick:a},"Logout"):r.a.createElement("button",{onClick:t},"Login")))}}]),a}(n.Component),f=a(19),v=a.n(f),E=a(35),b=a(162),y=a.n(b).a.create({baseURL:"https://j9qmzclk8i.execute-api.us-east-1.amazonaws.com/dev"});function O(e){return e&&null!==e||(e="null"),y.get("/allstores/"+e)}function S(e,t){return j.apply(this,arguments)}function j(){return(j=Object(E.a)(v.a.mark((function e(t,a){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting upload URL"),e.next=3,y.post("/stores/".concat(a,"/attachment"),"",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.getAccessToken())}});case 3:return n=e.sent,e.abrupt("return",n.data.uploadUrl);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return N.apply(this,arguments)}function N(){return(N=Object(E.a)(v.a.mark((function e(t,a){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.put(t,a);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C="FETCH_ALL_STORE",I="FETCH_STORE_LIST",w="FETCH_STORE",x="FETCH_CATEGORY_LIST",A=function(e){return function(){var t=Object(E.a)(v.a.mark((function t(a){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStore",e),t.next=3,r=e.auth,o=e.storeId,console.log("action: getStore api ",r,o),y.get("/stores/"+o,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.getAccessToken())}});case 3:n=t.sent,a({type:w,payload:n.data});case 5:case"end":return t.stop()}var r,o}),t)})));return function(e){return t.apply(this,arguments)}}()};function L(e,t){return e&&e.find((function(e){return e.StoreId===t}))||null}var T=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("Mounting dashboard"),console.log(this.props),this.props.fetchAllStores("")}},{key:"renderList",value:function(){return console.log("Rendering List"),console.log(this.props),this.props.allstores?this.props.allstores.Items.map((function(e){var t=e.attachmentUrl?e.attachmentUrl:"https://direktori-store-images-dev.s3.amazonaws.com/default-store.png",a=e.name.charAt(0).toUpperCase()+e.name.slice(1);return r.a.createElement("div",{className:"ui centered card",key:e.StoreId},r.a.createElement("div",{className:"image"},r.a.createElement("div",{className:"center aligned"},r.a.createElement("img",{src:t,width:"250",height:"250",alt:"No Store"}))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},a),r.a.createElement("div",{className:"description"},e.address)),r.a.createElement("div",{className:"extra content"},r.a.createElement("span",{className:"right floated"},e.phone?e.phone:"none")))})):r.a.createElement("div",null,"Loading...")}},{key:"handleNext",value:function(e){console.log("next handle:",e),e.fetchAllStores(e.allstores.LastEvaluatedKey.StoreId)}},{key:"renderButton",value:function(e){var t=this;return e?r.a.createElement("button",{className:"ui button",onClick:function(){t.handleNext(t.props)}},"More..."):r.a.createElement("div",null)}},{key:"render",value:function(){var e=this.props.allstores?this.props.allstores.LastEvaluatedKey:"";return r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui link cards"},this.renderList()),r.a.createElement("div",{className:"ui basic segment"},this.renderButton(e)))}}]),a}(r.a.Component);var _=Object(s.b)((function(e,t){return console.log("AllStore:mapping store to props",t,e),e.allstores?{allstores:e.allstores.items}:{}}),{fetchAllStores:function(e){return function(){var t=Object(E.a)(v.a.mark((function t(a){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStoreAllList"),t.next=3,O(e);case 3:n=t.sent,a({type:C,payload:n.data});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(T),D=a(15),U=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("mounting Storelist"),this.props.fetchStores(this.props)}},{key:"renderList",value:function(){return this.props.stores.items?this.props.stores.items.length>0?this.props.stores.items.map((function(e){var t="/stores/"+e.StoreId+"/edit",a="/stores/"+e.StoreId+"/delete",n=e.attachmentUrl?e.attachmentUrl:"https://direktori-store-images-dev.s3.amazonaws.com/default-store.png";return r.a.createElement("div",{className:"item",key:e.StoreId},r.a.createElement("i",null,r.a.createElement("div",{className:"ui grid"},r.a.createElement("div",{className:"two wide column"},r.a.createElement("img",{src:n,width:"50",height:"50",alt:"No Store"})),r.a.createElement("div",{className:"six wide column"},r.a.createElement("div",{className:"description"},r.a.createElement("h3",null,e.name),r.a.createElement("p",null,e.phone,r.a.createElement("br",null),e.address))),r.a.createElement("div",{className:"four wide column"},r.a.createElement("div",null,r.a.createElement("div",{className:"ui button"},r.a.createElement(p.b,{to:t},"Edit")),r.a.createElement("div",{className:"ui button"},r.a.createElement(p.b,{to:a},"Delete")))))))})):void 0:r.a.createElement("div",null,"Loading...")}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui segment",ref:this.wrapper},r.a.createElement("div",{className:"ui raised segment"},"My Stores"),r.a.createElement("div",{className:"ui button"},r.a.createElement(p.b,{to:"/stores/new",className:"button item"},"New Store")),r.a.createElement("div",{className:"ui segment"},this.renderList()))}}]),a}(r.a.Component),P=Object(s.b)((function(e,t){return console.log("StoreList:mapping store to props",e),{stores:e.stores}}),{fetchStores:function(e){return function(){var t=Object(E.a)(v.a.mark((function t(a){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStoreList"),t.next=3,r=e.auth,y.get("/stores",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.getAccessToken())}});case 3:n=t.sent,a({type:I,payload:n.data});case 5:case"end":return t.stop()}var r}),t)})));return function(e){return t.apply(this,arguments)}}()}})(U),F=a(55),z=a(25),B=a(57),R=a(83);var H=function(e){return r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:e.id},e.label),r.a.createElement("input",{id:e.id,type:e.type?e.type:"text",onChange:e.onChange,name:e.id,placeholder:e.placeholder,value:e.value}))};function M(e){return console.log(e),r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:e.id},e.label),r.a.createElement("select",{id:e.id,name:e.id,onChange:e.onChange,value:e.value},r.a.createElement("option",{value:""},e.defaultOption?e.defaultOption:"Please select"),e.options?e.options.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.text)})):null))}var J=function(e){return console.log("storeForm",e),r.a.createElement("form",{onSubmit:e.onSubmit},r.a.createElement("div",{className:"ui segment"},r.a.createElement(H,{id:"name",label:"Store Name",onChange:e.onChange,value:e.store.name}),r.a.createElement(H,{id:"address",label:"Address",onChange:e.onChange,value:e.store.address}),r.a.createElement(H,{id:"phone",label:"Telephone",onChange:e.onChange,value:e.store.phone}),r.a.createElement(H,{id:"notes",label:"Notes",value:e.store.notes,onChange:e.onChange}),r.a.createElement(M,{id:"categoryId",label:"Category",value:e.store.categoryId,onChange:e.onChange,options:e.categories})),r.a.createElement("input",{type:"Submit",className:"ui button"}))};var q=function(e){return function(e){console.log("actioning fetchCategory"),y.get("/categories",{headers:{"Content-Type":"application/json"}}).then((function(t){console.log(t),e({type:x,payload:t.data})}))}};var K=Object(s.b)((function(e,t){return e.categories&&e.categories.items?{categories:e.categories.items.map((function(e){return{value:e.categoryId,text:e.description,iconPath:e.iconPath}}))}:{categories:e.categories}}),{fetchCategory:q})((function(e){var t=e.fetchCategory,a=e.categories,o=Object(R.a)(e,["fetchCategory","categories"]),c=Object(n.useState)(Object(z.a)({},o.store)),s=Object(B.a)(c,2),i=s[0],l=s[1];return Object(n.useEffect)((function(){console.log("storeCreate:useEffect"),t(),console.log("storeCreate:useEffect.done")}),[]),console.log("categories",a),r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui form"},r.a.createElement("div",{className:"ui segment header"},"Store Create"),r.a.createElement(J,{store:i,categories:a,onChange:function(e){var t=Object(z.a)(Object(z.a)({},i),{},Object(F.a)({},e.target.name,e.target.value));l(t)},onSubmit:function(e){e.preventDefault(),console.log(o),console.log(i),function(e,t){return y.post("/stores",t,{headers:{Authorization:"Bearer ".concat(e.getAccessToken())}})}(o.auth,i).then((function(){o.history.push("/stores/")})),console.log("submitted")}})))})),G=a(343),Y="UPLOAD_NOUPLOAD",W="UPLOAD_FETCHURL",Q="UPLOAD_UPLOADING";var V=function(e){var t=Object(n.useState)({imageUrl:"",imageLocalPath:null,StoreId:e.store.StoreId,uploadState:Y}),a=Object(B.a)(t,2),o=a[0],c=a[1];function s(){return(s=Object(E.a)(v.a.mark((function t(a){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),console.log(e),!e.onImageSubmit){t.next=4;break}return t.abrupt("return",e.onImageSubmit());case 4:if(t.prev=4,o.imageLocalPath){t.next=8;break}return alert("File should be selected"),t.abrupt("return");case 8:return i(W),t.next=11,S(e.auth,e.store.StoreId);case 11:return n=t.sent,i(Q),t.next=15,k(n,o.imageLocalPath);case 15:alert("File was uploaded!"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),alert("Could not upload a file: "+t.t0.message);case 21:return t.prev=21,i(Y),t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[4,18,21,24]])})))).apply(this,arguments)}function i(e){var t=Object(z.a)(Object(z.a)({},o),{},{uploadState:e});c(t)}return e.store.StoreId?r.a.createElement(G.a,{onSubmit:function(e){return s.apply(this,arguments)}},r.a.createElement(G.a.Field,null,r.a.createElement("label",null,"File"),r.a.createElement("input",{type:"file",accept:"image/*",placeholder:"Image to upload",onChange:function(e){var t=e.target.files;if(console.log(t),t){var a=Object(z.a)(Object(z.a)({},o),{},{imageLocalPath:t[0]});c(a)}}})),r.a.createElement("input",{type:"Submit",className:"ui button"})):r.a.createElement("div",null)};var X=Object(s.b)((function(e,t){console.log("StoreEdit:mapping store to props",e);var a=t.match.params.StoreId;return e.categories&&e.categories.items?{categories:e.categories.items.map((function(e){return{value:e.categoryId,text:e.description,iconPath:e.iconPath}})),store:L(e.stores.items,a)}:{categories:e.categories,store:L(e.stores.items,a)}}),{fetchStore:A,fetchCategory:q})((function(e){var t=e.fetchCategory,a=e.categories,o=Object(R.a)(e,["fetchCategory","categories"]),c=Object(n.useState)(Object(z.a)({},o.store)),s=Object(B.a)(c,2),i=s[0],l=s[1];return Object(n.useEffect)((function(){console.log("StoreEdit:useEffect"),t(),console.log("StoreEdit:useEffect.done")}),[]),i?r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui form"},r.a.createElement("div",{className:"ui segment header"},"Store Edit"),r.a.createElement(J,{store:i,categories:a,onChange:function(e){var t=Object(z.a)(Object(z.a)({},i),{},Object(F.a)({},e.target.name,e.target.value));l(t)},onSubmit:function(e){e.preventDefault(),function(e,t){return console.log(t),y.patch("/stores/"+t.StoreId,t,{headers:{Authorization:"Bearer ".concat(e.getAccessToken())}})}(o.auth,i).then((function(){o.history.push("/stores/")})),console.log("submitted")}}),r.a.createElement(V,{store:i,auth:o.auth}))):r.a.createElement("div",null,"loading")})),Z=function(e){return c.a.createPortal(r.a.createElement("div",{onClick:e.onDismiss,className:"ui dimmer modals visible active"},r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"ui standard modal visible active"},r.a.createElement("div",{className:"header"},e.title?e.title:"Are You Sure"),r.a.createElement("div",{className:"content"},e.content?e.content:"..."," "),r.a.createElement("div",{className:"actions"},e.actions))),document.querySelector("#modal"))};var $=Object(s.b)((function(e,t){console.log("StoreDelete:mapping store to props",e);var a=t.match.params.StoreId;return{store:L(e.stores.items,a)}}),{fetchStore:A})((function(e){Object(n.useEffect)((function(){}));var t=r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"ui negative button",value:e.match.params.StoreId,onClick:function(t){console.log(t.target.value),(a=e.auth,n=t.target.value,console.log(n),y.delete("/stores/"+n,{headers:{Authorization:"Bearer ".concat(a.getAccessToken())}})).then((function(){return e.history.push("/stores")}));var a,n}},"Delete"),r.a.createElement("button",{className:"ui button",onClick:function(){return e.history.push("/stores")}},"Cancel"));return console.log(e),r.a.createElement("div",null,"StoreDelete",r.a.createElement(Z,Object.assign({},e,{actions:t,onDismiss:function(){return e.history.push("/stores")},content:"Are you sure you want to delete ".concat(e.store.name)})))})),ee=a(178),te=function(){function e(t){var a=this;Object(u.a)(this,e),this.login=function(){a.auth0.authorize()},this.logout=function(){a.clearSession(),a.auth0.logout(),a.history.push("/")},this.handleAuthentication=function(){a.auth0.parseHash((function(e,t){t&&t.accessToken&&t.idToken?(a.setSession(t),a.history.push("/")):e&&(a.history.push("/"),alert("Error: ".concat(e.error)),console.log(e))}))},this.setSession=function(e){console.log(e);var t=JSON.stringify(1e3*e.expiresIn+(new Date).getTime());localStorage.setItem("access_token",e.accessToken),localStorage.setItem("id_token",e.idToken),localStorage.setItem("expires_at",t)},this.history=t,console.log("dev-w02ayhsv.auth0.com"),this.auth0=new ee.a.WebAuth({domain:"dev-w02ayhsv.auth0.com",clientID:"3nywucPoC05Fr7vkoqDUIcrgau1HKJlm",redirectUri:"https://direktori.perdhevi.com/callback",audience:"http://localhost:3002",responseType:"token id_token",scope:"openid profile email"})}return Object(m.a)(e,[{key:"clearSession",value:function(){localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at")}},{key:"isAuthenticated",value:function(){if(localStorage.getItem("expires_at")){var e=JSON.parse(localStorage.getItem("expires_at"));return(new Date).getTime()<e}return!1}},{key:"getAccessToken",value:function(){var e=localStorage.getItem("access_token");if(!e)throw new Error("no Access Token");return e}}]),e}(),ae=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){if(!/access_token|id_token|err/.test(this.props.location.hash))throw new Error("Invalid callback URL");this.props.auth.handleAuthentication()}},{key:"render",value:function(){return r.a.createElement("div",null,"Loading...")}}]),a}(n.Component),ne=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).auth=new te(n.props.history),n}return Object(m.a)(a,[{key:"render",value:function(e){var t=this;return r.a.createElement("div",{className:"container"},r.a.createElement(g,Object.assign({auth:this.auth},e)),r.a.createElement(D.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(_,Object.assign({auth:t.auth},e))}}),r.a.createElement(D.a,{path:"/callback",exact:!0,render:function(e){return r.a.createElement(ae,Object.assign({auth:t.auth},e))}}),r.a.createElement(D.a,{path:"/stores",exact:!0,render:function(e){return r.a.createElement(P,Object.assign({auth:t.auth},e))}}),r.a.createElement(D.a,{path:"/stores/new",exact:!0,render:function(e){return r.a.createElement(K,Object.assign({auth:t.auth},e))}}),r.a.createElement(D.a,{path:"/stores/:StoreId/edit",exact:!0,render:function(e){return r.a.createElement(X,Object.assign({auth:t.auth},e))}}),r.a.createElement(D.a,{path:"/stores/:StoreId/delete",exact:!0,render:function(e){return r.a.createElement($,Object.assign({auth:t.auth},e))}}))}}]),a}(n.Component),re=Object(i.c)({stores:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing store reducers",e),t.type){case I:case w:return t.payload;default:return e}},categories:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing category reducers"),t.type){case x:return t.payload;default:return e}},allstores:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing all store reducers",e),t.type){case C:if(console.log("mapping all stores",e,t.payload),e.items){var a=t.payload;a.items.Items=e.items.Items.concat(t.payload.items.Items),console.log(a)}return t.payload;default:return e}}}),oe=Object(i.d)(re,Object(i.a)(l.a));c.a.render(r.a.createElement(s.a,{store:oe},r.a.createElement(r.a.StrictMode,null,r.a.createElement(p.a,null,r.a.createElement(D.a,{component:ne})))),document.getElementById("root"))}},[[189,1,2]]]);
//# sourceMappingURL=main.d998288b.chunk.js.map