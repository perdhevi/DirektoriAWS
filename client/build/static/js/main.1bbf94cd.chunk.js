(this["webpackJsonpfront-admin"]=this["webpackJsonpfront-admin"]||[]).push([[0],{188:function(e,t,a){e.exports=a(332)},332:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(34),c=a.n(o),s=a(30),l=a(47),i=a(160),u=a(20),m=a(21),d=a(23),p=a(22),h=a(24),g=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.auth,t=e.login,a=e.logout,n=e.isAuthenticated;return r.a.createElement("div",{className:"ui menu top "},r.a.createElement("div",{className:"item"},r.a.createElement(h.b,{to:"/"},"Home")),n()?r.a.createElement("div",{className:"item"},r.a.createElement(h.b,{to:"/stores"},"Store")):r.a.createElement("div",null),n()?r.a.createElement("div",{className:"item"},r.a.createElement(h.b,{to:"/categories"},"Category")):r.a.createElement("div",null),r.a.createElement("div",{className:"item right"},n()?r.a.createElement("button",{onClick:a},"Logout"):r.a.createElement("button",{onClick:t},"Login")))}}]),a}(n.Component),v=a(16),f=a.n(v),E=a(31),b=a(161),y=a.n(b).a.create({baseURL:"https://j9qmzclk8i.execute-api.us-east-1.amazonaws.com/dev"});function O(e){return e&&null!==e||(e="null"),y.get("/allstores/"+e)}function j(e,t){return S.apply(this,arguments)}function S(){return(S=Object(E.a)(f.a.mark((function e(t,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting upload URL"),e.next=3,y.post("/stores/".concat(a,"/attachment"),"",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.getAccessToken())}});case 3:return n=e.sent,e.abrupt("return",n.data.uploadUrl);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return k.apply(this,arguments)}function k(){return(k=Object(E.a)(f.a.mark((function e(t,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.put(t,a);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w="FETCH_ALL_STORE",C="FETCH_STORE_LIST",x="FETCH_STORE",I="FETCH_CATEGORY_LIST",A=function(e){return function(){var t=Object(E.a)(f.a.mark((function t(a){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStore",e),t.next=3,r=e.auth,o=e.storeId,console.log("action: getStore api ",r,o),y.get("/stores/"+o,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.getAccessToken())}});case 3:n=t.sent,a({type:x,payload:n.data});case 5:case"end":return t.stop()}var r,o}),t)})));return function(e){return t.apply(this,arguments)}}()};function L(e,t){return e&&e.find((function(e){return e.StoreId===t}))||null}var T=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("Mounting dashboard"),console.log(this.props),this.props.fetchAllStores("")}},{key:"renderList",value:function(){return console.log("Rendering List"),console.log(this.props),this.props.allstores?this.props.allstores.Items.map((function(e){var t=e.attachmentUrl?e.attachmentUrl:"https://direktori-store-images-dev.s3.amazonaws.com/default-store.png",a=e.name.charAt(0).toUpperCase()+e.name.slice(1);return r.a.createElement("div",{className:"ui centered card",key:e.StoreId},r.a.createElement("div",{className:"image"},r.a.createElement("div",{className:"center aligned"},r.a.createElement("img",{src:t,width:"250",height:"250",alt:"No Store"}))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},a),r.a.createElement("div",{className:"description"},e.address)),r.a.createElement("div",{className:"extra content"},r.a.createElement("span",{className:"right floated"},e.phone?e.phone:"none")))})):r.a.createElement("div",null,"Loading...")}},{key:"handleNext",value:function(e){console.log("next handle:",e),e.fetchAllStores(e.allstores.LastEvaluatedKey.StoreId)}},{key:"renderButton",value:function(e){var t=this;return e?r.a.createElement("button",{className:"ui button",onClick:function(){t.handleNext(t.props)}},"More..."):r.a.createElement("div",null)}},{key:"render",value:function(){var e=this.props.allstores?this.props.allstores.LastEvaluatedKey:"";return r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui link cards"},this.renderList()),r.a.createElement("div",{className:"ui basic segment"},this.renderButton(e)))}}]),a}(r.a.Component);var D=Object(s.b)((function(e,t){return console.log("AllStore:mapping store to props",t,e),e.allstores?{allstores:e.allstores.items}:{}}),{fetchAllStores:function(e){return function(){var t=Object(E.a)(f.a.mark((function t(a){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStoreAllList"),t.next=3,O(e);case 3:n=t.sent,a({type:w,payload:n.data});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(T),_=a(15),U=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("mounting Storelist"),this.props.fetchStores(this.props)}},{key:"renderList",value:function(){return this.props.stores.items?this.props.stores.items.length>0?this.props.stores.items.map((function(e){var t="/stores/"+e.StoreId+"/edit",a="/stores/"+e.StoreId+"/delete",n=e.attachmentUrl?e.attachmentUrl:"https://direktori-store-images-dev.s3.amazonaws.com/default-store.png";return r.a.createElement("div",{className:"item",key:e.StoreId},r.a.createElement("i",null,r.a.createElement("div",{className:"ui grid"},r.a.createElement("div",{className:"two wide column"},r.a.createElement("img",{src:n,width:"50",height:"50",alt:"No Store"})),r.a.createElement("div",{className:"six wide column"},r.a.createElement("div",{className:"description"},r.a.createElement("h3",null,e.name),r.a.createElement("p",null,e.phone,r.a.createElement("br",null),e.address))),r.a.createElement("div",{className:"four wide column"},r.a.createElement("div",null,r.a.createElement("div",{className:"ui button"},r.a.createElement(h.b,{to:t},"Edit")),r.a.createElement("div",{className:"ui button"},r.a.createElement(h.b,{to:a},"Delete")))))))})):void 0:r.a.createElement("div",null,"Loading...")}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui segment",ref:this.wrapper},r.a.createElement("div",{className:"ui raised segment"},"My Stores"),r.a.createElement("div",{className:"ui button"},r.a.createElement(h.b,{to:"/stores/new",className:"button item"},"New Store")),r.a.createElement("div",{className:"ui segment"},this.renderList()))}}]),a}(r.a.Component),F=Object(s.b)((function(e,t){return console.log("StoreList:mapping store to props",e),{stores:e.stores}}),{fetchStores:function(e){return function(){var t=Object(E.a)(f.a.mark((function t(a){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("actioning fetchStoreList"),t.next=3,r=e.auth,y.get("/stores",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.getAccessToken())}});case 3:n=t.sent,a({type:C,payload:n.data});case 5:case"end":return t.stop()}var r}),t)})));return function(e){return t.apply(this,arguments)}}()}})(U),P=a(55),z=a(32),B=a(57);var M=function(e){return r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:e.id},e.label),r.a.createElement("input",{id:e.id,type:e.type?e.type:"text",onChange:e.onChange,name:e.id,placeholder:e.placeholder,value:e.value}))};var R=function(e){return r.a.createElement("form",{onSubmit:e.onSubmit},r.a.createElement("div",{className:"ui segment"},r.a.createElement(M,{id:"name",label:"Store Name",onChange:e.onChange,value:e.store.name}),r.a.createElement(M,{id:"address",label:"Address",onChange:e.onChange,value:e.store.address}),r.a.createElement(M,{id:"phone",label:"Telephone",onChange:e.onChange,value:e.store.phone}),r.a.createElement(M,{id:"notes",label:"Notes",value:e.store.notes,onChange:e.onChange})),r.a.createElement("input",{type:"Submit",className:"ui button"}))},H=function(e){var t=Object(n.useState)({name:"",address:"",phone:"",notes:""}),a=Object(B.a)(t,2),o=a[0],c=a[1];return r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui form"},r.a.createElement("div",{className:"ui segment header"},"Store Create"),r.a.createElement(R,{store:o,onChange:function(e){var t=Object(z.a)(Object(z.a)({},o),{},Object(P.a)({},e.target.name,e.target.value));c(t)},onSubmit:function(t){t.preventDefault(),console.log(e),console.log(o),function(e,t){return y.post("/stores",t,{headers:{Authorization:"Bearer ".concat(e.getAccessToken())}})}(e.auth,o).then((function(){e.history.push("/stores/")})),console.log("submitted")}})))},J=a(342),q="UPLOAD_NOUPLOAD",K="UPLOAD_FETCHURL",G="UPLOAD_UPLOADING";var Y=function(e){var t=Object(n.useState)({imageUrl:"",imageLocalPath:null,StoreId:e.store.StoreId,uploadState:q}),a=Object(B.a)(t,2),o=a[0],c=a[1];function s(){return(s=Object(E.a)(f.a.mark((function t(a){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),console.log(e),!e.onImageSubmit){t.next=4;break}return t.abrupt("return",e.onImageSubmit());case 4:if(t.prev=4,o.imageLocalPath){t.next=8;break}return alert("File should be selected"),t.abrupt("return");case 8:return l(K),t.next=11,j(e.auth,e.store.StoreId);case 11:return n=t.sent,l(G),t.next=15,N(n,o.imageLocalPath);case 15:alert("File was uploaded!"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),alert("Could not upload a file: "+t.t0.message);case 21:return t.prev=21,l(q),t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[4,18,21,24]])})))).apply(this,arguments)}function l(e){var t=Object(z.a)(Object(z.a)({},o),{},{uploadState:e});c(t)}return e.store.StoreId?r.a.createElement(J.a,{onSubmit:function(e){return s.apply(this,arguments)}},r.a.createElement(J.a.Field,null,r.a.createElement("label",null,"File"),r.a.createElement("input",{type:"file",accept:"image/*",placeholder:"Image to upload",onChange:function(e){var t=e.target.files;if(console.log(t),t){var a=Object(z.a)(Object(z.a)({},o),{},{imageLocalPath:t[0]});c(a)}}})),r.a.createElement("input",{type:"Submit",className:"ui button"})):r.a.createElement("div",null)};var W=Object(s.b)((function(e,t){console.log("StoreEdit:mapping store to props",e);var a=t.match.params.StoreId;return{store:L(e.stores.items,a)}}),{fetchStore:A})((function(e){var t=Object(n.useState)(Object(z.a)({},e.store)),a=Object(B.a)(t,2),o=a[0],c=a[1];return Object(n.useEffect)((function(){}),[o]),o?r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui form"},r.a.createElement("div",{className:"ui segment header"},"Store Edit"),r.a.createElement(R,{store:o,onChange:function(e){var t=Object(z.a)(Object(z.a)({},o),{},Object(P.a)({},e.target.name,e.target.value));c(t)},onSubmit:function(t){t.preventDefault(),function(e,t){return console.log(t),y.patch("/stores/"+t.StoreId,t,{headers:{Authorization:"Bearer ".concat(e.getAccessToken())}})}(e.auth,o).then((function(){e.history.push("/stores/")})),console.log("submitted")}}),r.a.createElement(Y,{store:o,auth:e.auth}))):r.a.createElement("div",null,"loading")})),Q=function(e){return c.a.createPortal(r.a.createElement("div",{onClick:e.onDismiss,className:"ui dimmer modals visible active"},r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"ui standard modal visible active"},r.a.createElement("div",{className:"header"},e.title?e.title:"Are You Sure"),r.a.createElement("div",{className:"content"},e.content?e.content:"..."," "),r.a.createElement("div",{className:"actions"},e.actions))),document.querySelector("#modal"))};var V=Object(s.b)((function(e,t){console.log("StoreDelete:mapping store to props",e);var a=t.match.params.StoreId;return{store:L(e.stores.items,a)}}),{fetchStore:A})((function(e){Object(n.useEffect)((function(){}));var t=r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"ui negative button",value:e.match.params.StoreId,onClick:function(t){console.log(t.target.value),(a=e.auth,n=t.target.value,console.log(n),y.delete("/stores/"+n,{headers:{Authorization:"Bearer ".concat(a.getAccessToken())}})).then((function(){return e.history.push("/stores")}));var a,n}},"Delete"),r.a.createElement("button",{className:"ui button",onClick:function(){return e.history.push("/stores")}},"Cancel"));return console.log(e),r.a.createElement("div",null,"StoreDelete",r.a.createElement(Q,Object.assign({},e,{actions:t,onDismiss:function(){return e.history.push("/stores")},content:"Are you sure you want to delete ".concat(e.store.name)})))})),X=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("mounting Categorylist"),console.log(this.props),this.props.fetchCategory(this.props)}},{key:"renderList",value:function(){return this.props.categories?(console.log(this.props.categories),this.props.categories.map((function(e){return r.a.createElement("div",{className:"item",key:e.id},r.a.createElement("i",null,r.a.createElement("div",{className:"ui grid"},r.a.createElement("div",{className:"eight wide column"},r.a.createElement("div",{className:"description"},r.a.createElement("h3",null,e.name),r.a.createElement("p",null,e.notes))))))}))):r.a.createElement("div",null,"Loading...")}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui raised segment"}," Category list"),r.a.createElement("div",{className:"ui button"},r.a.createElement(h.b,{to:"/categories/new",className:"button item"},"New Category")),r.a.createElement("div",{className:"ui segment"},this.renderList()))}}]),a}(r.a.Component),Z=Object(s.b)((function(e,t){return console.log("mapping category to props",t),console.log(e),{categories:e.categories}}),{fetchCategory:function(e){return function(){var e=Object(E.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("actioning fetchCategory"),t({type:I,payload:{data:[{id:0,name:"test"},{id:1,name:"test 2"}]}.data});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})(X),$=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){console.log("mounting Category New"),console.log(this.props)}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui segment"},r.a.createElement("div",{className:"ui raised segment"}," New Category "),r.a.createElement("div",{className:"ui raised segment"},r.a.createElement("form",null,r.a.createElement("label",null,"Name"),r.a.createElement("input",{id:"name",name:"name"}),r.a.createElement("input",{type:"submit"}))))}}]),a}(r.a.Component),ee=a(177),te=function(){function e(t){var a=this;Object(u.a)(this,e),this.login=function(){a.auth0.authorize()},this.logout=function(){a.clearSession(),a.auth0.logout(),a.history.push("/")},this.handleAuthentication=function(){a.auth0.parseHash((function(e,t){t&&t.accessToken&&t.idToken?(a.setSession(t),a.history.push("/")):e&&(a.history.push("/"),alert("Error: ".concat(e.error)),console.log(e))}))},this.setSession=function(e){console.log(e);var t=JSON.stringify(1e3*e.expiresIn+(new Date).getTime());localStorage.setItem("access_token",e.accessToken),localStorage.setItem("id_token",e.idToken),localStorage.setItem("expires_at",t)},this.history=t,console.log("dev-w02ayhsv.auth0.com"),this.auth0=new ee.a.WebAuth({domain:"dev-w02ayhsv.auth0.com",clientID:"3nywucPoC05Fr7vkoqDUIcrgau1HKJlm",redirectUri:"http://localhost:3000/callback",audience:"http://localhost:3002",responseType:"token id_token",scope:"openid profile email"})}return Object(m.a)(e,[{key:"clearSession",value:function(){localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at")}},{key:"isAuthenticated",value:function(){if(localStorage.getItem("expires_at")){var e=JSON.parse(localStorage.getItem("expires_at"));return(new Date).getTime()<e}return!1}},{key:"getAccessToken",value:function(){var e=localStorage.getItem("access_token");if(!e)throw new Error("no Access Token");return e}}]),e}(),ae=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){if(!/access_token|id_token|err/.test(this.props.location.hash))throw new Error("Invalid callback URL");this.props.auth.handleAuthentication()}},{key:"render",value:function(){return r.a.createElement("div",null,"Loading...")}}]),a}(n.Component),ne=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).auth=new te(n.props.history),n}return Object(m.a)(a,[{key:"render",value:function(e){var t=this;return r.a.createElement("div",{className:"container"},r.a.createElement(g,Object.assign({auth:this.auth},e)),r.a.createElement(_.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(D,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/callback",exact:!0,render:function(e){return r.a.createElement(ae,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/stores",exact:!0,render:function(e){return r.a.createElement(F,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/stores/new",exact:!0,render:function(e){return r.a.createElement(H,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/stores/:StoreId/edit",exact:!0,render:function(e){return r.a.createElement(W,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/stores/:StoreId/delete",exact:!0,render:function(e){return r.a.createElement(V,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/categories",exact:!0,render:function(e){return r.a.createElement(Z,Object.assign({auth:t.auth},e))}}),r.a.createElement(_.a,{path:"/categories/new",exact:!0,render:function(e){return r.a.createElement($,Object.assign({auth:t.auth},e))}}))}}]),a}(n.Component),re=Object(l.c)({stores:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing store reducers",e),t.type){case C:case x:return t.payload;default:return e}},categories:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing category reducers"),t.type){case I:return t.payload;default:return e}},allstores:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("executing all store reducers",e),t.type){case w:if(console.log("mapping all stores",e,t.payload),e.items){var a=t.payload;a.items.Items=e.items.Items.concat(t.payload.items.Items),console.log(a)}return t.payload;default:return e}}}),oe=Object(l.d)(re,Object(l.a)(i.a));c.a.render(r.a.createElement(s.a,{store:oe},r.a.createElement(r.a.StrictMode,null,r.a.createElement(h.a,null,r.a.createElement(_.a,{component:ne})))),document.getElementById("root"))}},[[188,1,2]]]);
//# sourceMappingURL=main.1bbf94cd.chunk.js.map